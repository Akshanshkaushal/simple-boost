{"version":3,"file":"utils.js","sourceRoot":"","sources":["../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["export const linkFallback = (paymentRequest: string): void => {\n  const src = `lightning:${paymentRequest}`;\n  const link = document.createElement('a');\n  link.href = src;\n  link.target = '_blank';\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n};\n\nexport const requestInvoice = async (\n  lnurl: string,\n  sats: number\n): Promise<{pr: string}> => {\n  let response;\n  try {\n    response = await requestInvoiceFromLnurl(lnurl, sats);\n  } catch (e) {\n    console.error(e);\n    response = await requestInvoiceWithProxy(lnurl, sats);\n  }\n  return response;\n};\n\nexport const requestInvoiceWithProxy = (\n  lnurl: string,\n  sats: number\n): Promise<{pr: string}> => {\n  const url = `https://embed.twentyuno.net/invoice?to=${lnurl}&amount=${sats}&comment=`;\n  return fetch(url)\n    .then((response) => {\n      if (response.ok) {\n        return response.json();\n      } else {\n        throw new Error('Network response was not OK');\n      }\n    })\n    .then((response) => {\n      return {pr: response.payment_request};\n    });\n};\n\nexport const requestInvoiceFromLnurl = (\n  lnurl: string,\n  sats: number\n): Promise<{pr: string}> => {\n  let url = lnurl;\n  if (lnurl.match(/@/)) {\n    const [user, host] = lnurl.split('@');\n    url = `https://${host}/.well-known/lnurlp/${user}`;\n  }\n  return fetch(url)\n    .then((response) => {\n      if (response.ok) {\n        return response.json();\n      } else {\n        throw new Error('Network response was not OK');\n      }\n    })\n    .then((lnurl) => {\n      const url = new URL(lnurl.callback);\n      const amount = sats * 1000;\n      url.searchParams.set('amount', amount.toString());\n      return fetch(url.toString()).then((response) => {\n        if (response.ok) {\n          return response.json();\n        } else {\n          throw new Error('Invoice creation failed');\n        }\n      });\n    });\n};\n"]}